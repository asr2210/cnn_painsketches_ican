# Computer Vision for Classification of Pain Sketches for Lower Extremity Amputees Using Custom Convolutional Neural Networks
The notebook published here contains code for the training, validation, and testing of custom CNNs for both the binary classification and hierarchical clustering of pain sketches for lower extremity amputees. Relevant documentation is provided in-line within the notebook; we have also outlined some important points below.

## Table of Contents

- [Introduction](#introduction)
- [Requirements](#requirements)
- [Data](#data)
- [Custom CNN Architecture](#custom-cnn-architecture)
- [Model Training and Evaluation](#model-training-and-evaluation)
- [Feature Extraction and Hierarchical Clustering](#feature-extraction-and-hierarchical-clustering)

## Introduction

This project involves two primary tasks:
1. **Binary Classification:** Training a CNN to classify pain sketches into one of two predefined categories based on model-extracted features.
2. **Hierarchical Clustering:** Extracting features from the CNN and clustering the sketches based on these features to identify patterns and group similar sketches in an unsupervised fashion.

## Requirements

The following libraries are required, which can be installed using pip:

- Python 3.x
- TensorFlow
- Keras
- NumPy
- Matplotlib
- Scikit-learn
- Pandas
- SciPy

```bash
pip install tensorflow keras numpy matplotlib scikit-learn pandas scipy
```

## Data
Model input consists of uniformly sized JPEG images, generated by cropping scanned PDFs of patient pain sketches at prespecified indices. The data preprocessing steps include:

- Loading images from a directory.
- Cropping, resizing, and converting images to grayscale.
- Generating mirrored versions of the images to augment the dataset (removing potential model bias from laterality).
- Associating each image with a rating (no pain (NP), focal pain (FP), diffuse pain (DP), radiating pain (RP) as per Gomez-Eslava et al. 2024) from a provided Excel file.

Manual downsampling towards the minority class is also performed during data preprocessing to achieved balanced classes prior to model training.

## Custom CNN Architecture
The binary classification CNN model includes the following layers:

- Convolutional Layers: For feature extraction using ReLU activation.
- MaxPooling Layers: For downsampling.
- Dropout Layer: To prevent overfitting.
- Dense Layers: For decision-making with ReLU and sigmoid activations.
- Squeeze and Excitation Block: A specialized attention block is included in the CNN for feature refinement.

## Model Training and Evaluation
Models are trained using binary cross-entropy loss and evaluated on traditional accuracy metrics (precision, recall, F1 score, AUROC). The notebook includes visualization of the training and validation accuracy and loss over epochs. Confusion matrices are provided. 70% of the dataset is reserved for training, 15% for validation, and 15% for testing.

## Feature Extraction and Hierarchical Clustering
Using the CNN architecture outlined above, features are extracted from the images. These features are then used for hierarchical clustering. A dendrogram is provided to visualize clustering thresholds. Thresholds can be used to generate representative sketches from clusters formed at a given threshold.
